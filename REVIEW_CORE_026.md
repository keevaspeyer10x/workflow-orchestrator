# Code Review: Task Provider & CLI Integration

## Overall Impression
The implementation of the Task Provider system (Issue #56) is well-structured and follows the plan closely. The separation of concerns between the interface, backends, and CLI is clean. The `LocalTaskProvider` is robust and well-tested.

However, I have a significant concern regarding the `GitHubTaskProvider`'s `update_task` method, specifically how it handles labels, which seems to contradict its own comments and typical "update" semantics.

## ðŸŸ¢ strengths
- **Architecture**: The `TaskProvider` abstract base class and the factory pattern in `__init__.py` provide a solid foundation for future extensions.
- **Local Backend**: `LocalTaskProvider` uses atomic writes (`.tmp` + rename), which is a great practice for file-based persistence.
- **Testing**: `tests/test_task_provider.py` is comprehensive for the core logic and `LocalTaskProvider`.
- **CLI Design**: The CLI commands are intuitive and cover the essential CRUD operations.

## ðŸ”´ Concerns & Bugs

### 1. GitHub Label Update Logic (Potential Bug)
In `src/task_provider/backends/github.py`:
```python
        if "labels" in updates:
            # Note: This replaces all labels
            for label in updates["labels"]:
                args.extend(["--add-label", label])
```
- **The Issue**: The comment states "This replaces all labels", but `gh issue edit --add-label` **appends** labels to the existing set. It does not remove labels that are not in the new list.
- **Impact**: If a task has labels `["A"]` and you update it with `labels=["B"]`, the result will be `["A", "B"]`, not `["B"]` as implied by the comment and typical "update" semantics.
- **Recommendation**: Either update the comment to reflect that this is an additive operation, or implement true replacement logic (which usually requires fetching existing labels and removing the ones not in the new set, or using the API directly).

### 2. Missing Tests for `GitHubTaskProvider.update_task`
- `tests/test_task_provider.py` includes mocks for `create_task`, `list_tasks`, and `close_task` for the GitHub provider, but **skips** `update_task`.
- This explains why the label logic issue wasn't caught.
- **Action**: Add a test case for `update_task` that verifies the `gh` command arguments, and decide on the desired behavior for labels.

### 3. CLI Output Truncation
- In `cmd_task_list`, the title is hard-truncated at 40 characters:
  ```python
  print(f"{task.id:<6} {priority_str:<10} {task.status.value:<12} {task.title[:40]}")
  ```
- **Suggestion**: Consider making this dynamic based on terminal width or at least slightly longer, as 40 chars is quite short for task titles.

## Questions
1. **YAGNI Section**: The `_render_body` method (in both providers) auto-generates a "YAGNI Check" section. Is this intended for *every* task added via CLI? It seems specific to "Feature Requests" or "Proposals". For a quick "Fix typo" task, this might be overkill.
2. **Sync Behavior**: Is there a plan for synchronization between Local and GitHub? Currently, they are distinct silos.

## Decision
**Request Changes** before merging.
The `GitHubTaskProvider.update_task` label logic needs to be clarified or fixed, and a corresponding test case added.

---
*Review generated by a skeptical senior engineer.*
