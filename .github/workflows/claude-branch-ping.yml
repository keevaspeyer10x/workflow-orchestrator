# Claude Branch Ping Workflow (UNTRUSTED)
#
# This workflow runs when any claude/* branch is pushed. Since it runs on
# untrusted code, it has minimal permissions and only notifies the coordinator.
#
# Security: This workflow ONLY reads the branch name and SHA, then dispatches
# an event. It does NOT checkout code or run any scripts from the branch.
#
# See: docs/FINAL-merge-conflict-system-design.md Section 13.1

name: Claude Branch Ping

on:
  push:
    branches:
      - 'claude/**'

permissions:
  contents: read

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Notify coordinator
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          event-type: claude-branch-update
          client-payload: |
            {
              "branch": "${{ github.ref_name }}",
              "sha": "${{ github.sha }}",
              "actor": "${{ github.actor }}",
              "timestamp": "${{ github.event.head_commit.timestamp }}"
            }
