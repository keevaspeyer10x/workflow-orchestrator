# AI Code Reviews
# Generated by workflow-orchestrator setup-reviews
# See: https://github.com/keevaspeyer10x/workflow-orchestrator

name: AI Code Reviews

on:
  pull_request:
    types: [opened, synchronize, reopened]

# Required secrets:
# - OPENAI_API_KEY: For Codex reviews
# - GEMINI_API_KEY: For Gemini reviews (if using Gemini Action directly)

jobs:
  security-review:
    name: "ðŸ”’ Security Review"
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for better context

      - name: Security Review (Codex)
        uses: openai/codex-action@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          mode: review
          custom-instructions: |
            Focus on security vulnerabilities in AI-generated code.
            Check for: injection (SQL, command, XSS), auth bypasses,
            hardcoded secrets, SSRF, path traversal, insecure deserialization.
            This code has had ZERO human review - be thorough.

  consistency-review:
    name: "ðŸ”„ Consistency Review"
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Consistency Review (Gemini)
        uses: google/gemini-code-assist-action@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          # Uses .gemini/styleguide.md for custom instructions

  quality-review:
    name: "âœ¨ Quality Review"
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Quality Review (Codex)
        uses: openai/codex-action@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          mode: review
          custom-instructions: |
            Focus on code quality and production readiness.
            Check for: edge cases, error handling, resource cleanup,
            input validation, complexity, test coverage gaps.
            AI agents focus on happy paths - find the unhappy paths.

  holistic-review:
    name: "ðŸŽ¯ Holistic Review"
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Holistic Review (Gemini)
        uses: google/gemini-code-assist-action@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          custom-prompt: |
            Review this AI-generated code with fresh eyes.
            Security, consistency, and quality reviews have already run.
            What else concerns you? Would you approve this PR?
            What questions would you ask? What would you do differently?
            Be the skeptical senior engineer this code hasn't had.
